import{a as c,g as A,k as d,l as i,m as I,n as x,o as M,p as j,q as w,s as u,t as n,u as y}from"./chunk-UHDG3LV6.js";import{P as m,R as f,Rb as L,U as g,_ as s,f as p}from"./chunk-T6VZZ3TQ.js";var N=(()=>{class t{api_url=s(w);http=s(c);login(o){return this.http.post(`${this.api_url}/login`,o,{withCredentials:!0})}register(o){return this.http.post(`${this.api_url}/signup`,o,{withCredentials:!0})}user(){return this.http.get(`${this.api_url}/user`,{withCredentials:!0})}logout(){return this.http.post(`${this.api_url}/logout`,{},{withCredentials:!0})}static \u0275fac=function(e){return new(e||t)};static \u0275prov=g({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})();var C={user:null,isLoading:!1},h=I({providedIn:"root"},j(C),x(({user:t})=>({isAuthenticated:L(()=>!!t())})),M((t,l=s(N),o=s(A),e=s(y))=>({getUser:d(p(f(()=>i(t,{isLoading:!0})),m(()=>l.user().pipe(u({next:r=>{i(t,{user:r.user,isLoading:!1}),e.set(n.EMAIL,r.user.email),e.set(n.ID,r.user.id),e.set(n.NAME,r.user.firstName+r.user.lastName)},error:r=>{i(t,{isLoading:!1}),console.error(r)}}))))),login:d(p(f(()=>i(t,{isLoading:!0})),m(r=>l.login(r).pipe(u({next:a=>{i(t,{user:a.user,isLoading:!1}),e.set(n.EMAIL,a.user.email),e.set(n.ID,a.user.id),e.set(n.NAME,a.user.firstName+a.user.lastName),o.navigateByUrl("projects")},error:a=>{i(t,{isLoading:!1}),console.error(a)}}))))),register:d(p(f(()=>i(t,{isLoading:!0})),m(r=>l.register(r).pipe(u({next:a=>{i(t,{user:a.user,isLoading:!1}),e.set(n.EMAIL,a.user.email),e.set(n.ID,a.user.id),e.set(n.NAME,a.user.firstName+a.user.lastName),o.navigateByUrl("projects")},error:a=>{i(t,{isLoading:!1}),console.error(a)}}))))),logout:d(p(f(()=>i(t,{isLoading:!0})),m(()=>l.logout().pipe(u({next:r=>{i(t,{user:null,isLoading:!1}),e.delete(n.EMAIL),e.delete(n.ID),e.delete(n.NAME),o.navigateByUrl("login")},error:r=>{i(t,{user:null,isLoading:!1}),o.navigateByUrl("login")}}))))),initializeAuthState:()=>(i(t,{isLoading:!0}),l.user().pipe(u({next:r=>{i(t,{user:r.user,isLoading:!1})},error:r=>{r.status===401?i(t,{user:null,isLoading:!1}):console.error("Unexpected error:",r)}})))})));function T(){let t=s(h);return()=>t.initializeAuthState()}var v=(()=>{class t{authStore=s(h);router=s(A);canActivate(){let{isAuthenticated:o}=this.authStore;return o()||this.router.navigateByUrl("login"),o()}static \u0275fac=function(e){return new(e||t)};static \u0275prov=g({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})();export{h as a,v as b,T as c};
